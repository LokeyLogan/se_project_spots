!function(){"use strict";var e="";const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},r=(e,t,r)=>{const o=e.querySelector(`#${t.id}-error`);o&&(o.textContent=""),t.classList.remove(r.inputErrorClass)},o=(e,t,r)=>{t&&((e=>e.some((e=>!e.validity.valid)))(e)?((e,t)=>{e&&(e.disabled=!0,e.classList.add(t.inactiveButtonClass))})(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass)))};var n=class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}updateAvatar(e){let{avatar:t}=e;return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addCard(e){let{name:t,link:r}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}unlikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}},a=e+"d3610e9c6dce3cb370d8.svg",s=e+"d38272e02bb4f1ab1c37.svg",l=e+"40608da7369d39bc1077.svg",d=e+"dba18798529f242c4c6d.svg",c=e+"d73f076c46eb5467f5fc.svg";document.addEventListener("DOMContentLoaded",(()=>{document.querySelector(".header__logo").src=a,document.querySelector(".profile__pencil-icon").src=c,document.querySelector(".profile__edit-btn img").src=s,document.querySelector(".profile__add-btn img").src=l,document.querySelectorAll(".modal__close-btn img").forEach((e=>{e.src=d}));const e=new n({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"b11e468b-3f59-4efb-985e-f8545b79cf07","Content-Type":"application/json"}}),i=document.querySelector(".profile__edit-btn"),u=document.querySelector(".profile__add-btn"),m=document.querySelector(".profile__avatar-btn"),_=document.querySelector(".profile__name"),h=document.querySelector(".profile__description"),f=document.querySelector(".profile__avatar"),v=document.querySelector("#edit-profile-modal"),b=document.querySelector("#avatar-modal"),p=document.querySelector("#add-card-modal"),y=document.querySelector("#preview-modal"),S=document.forms["edit-profile"],q=v.querySelector("#profile-name-input"),E=v.querySelector("#profile-description-input"),k=S.querySelector(".modal__submit-btn"),C=document.forms.card__form,g=C.querySelector(".modal__submit-btn"),L=p.querySelector("#add-card-name-input"),$=p.querySelector("#add-card-link-input"),U=document.forms["edit-avatar"],x=U.querySelector("#profile-avatar-input"),j=U.querySelector(".modal__submit-btn"),P=y.querySelector(".modal__image"),A=y.querySelector(".modal__caption"),D=document.querySelector("#card-template"),I=document.querySelector(".cards__list"),T=document.querySelector("#delete-modal"),B=document.forms["confirm-delete"],O=B.querySelector("button[type='submit']");let w=null,N=null;function J(e){e.classList.add("modal_opened"),document.addEventListener("keydown",M)}function H(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",M)}function M(e){if("Escape"===e.key){const e=document.querySelector(".modal_opened");e&&H(e)}}function R(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend";const o=function(t){const r=D.content.querySelector(".card").cloneNode(!0),o=r.querySelector(".card__title"),n=r.querySelector(".card__image"),a=r.querySelector(".card__like-button"),s=r.querySelector(".card__delete-button");return o.textContent=t.name,n.src=t.link,n.alt=t.name,t.isLiked&&a.classList.add("card__like-button-liked"),a.addEventListener("click",(()=>{(a.classList.contains("card__like-button-liked")?e.unlikeCard(t._id):e.likeCard(t._id)).then((e=>{a.classList.toggle("card__like-button-liked",e.isLiked)})).catch((e=>{console.error("❌ Like/Unlike failed:",e)}))})),n.addEventListener("click",(()=>{J(y),P.src=t.link,P.alt=t.name,A.textContent=t.name})),s.addEventListener("click",(()=>{w=r,N=t._id,J(T)})),r}(t);I[r](o)}B.addEventListener("submit",(t=>{t.preventDefault(),N&&(O.textContent="Deleting...",e.removeCard(N).then((()=>{w.remove(),H(T)})).catch((e=>{console.error("❌ Delete failed:",e)})).finally((()=>{O.textContent="Yes, Delete"})))})),document.querySelectorAll(".modal__close-btn").forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>H(t)))})),document.querySelectorAll(".modal").forEach((e=>{e.addEventListener("click",(t=>{t.target===e&&H(e)}))})),i.addEventListener("click",(()=>{q.value=_.textContent,E.value=h.textContent,((e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);n.forEach((o=>r(e,o,t))),o(n,a,t)})(S,t),J(v)})),u.addEventListener("click",(()=>J(p))),m.addEventListener("click",(()=>J(b))),S.addEventListener("submit",(function(t){t.preventDefault();const r=q.value,o=E.value;k.textContent="Saving...",e.editUserInfo({name:r,about:o}).then((e=>{_.textContent=e.name,h.textContent=e.about,H(v)})).catch((e=>console.error("❌ Error updating user:",e))).finally((()=>{k.textContent="Save"}))})),C.addEventListener("submit",(function(t){t.preventDefault();const r=L.value.trim(),o=$.value.trim();r&&o?(g.disabled=!0,g.textContent="Saving...",e.addCard({name:r,link:o}).then((e=>{R(e,"prepend"),C.reset(),H(p)})).catch((e=>console.error("❌ Error adding card:",e))).finally((()=>{g.disabled=!1,g.textContent="Save"}))):alert("Please enter both a name and a valid image URL.")})),U.addEventListener("submit",(function(t){t.preventDefault();const r=x.value.trim();r?(j.textContent="Saving...",e.updateAvatar({avatar:r}).then((e=>{f.src=e.avatar,H(b),U.reset()})).catch((e=>{console.error("❌ Error updating avatar:",e)})).finally((()=>{j.textContent="Save"}))):alert("Please enter a valid image URL.")})),e.getAppInfo().then((e=>{let[t,r]=e;t.forEach((e=>{R(e,"append")})),f.src=r.avatar,_.textContent=r.name,h.textContent=r.about})).catch((e=>{console.error("Failed to load cards or user info from API:",e)})),(e=>{document.querySelectorAll(e.formSelector).forEach((t=>((e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);o(n,a,t),n.forEach((e=>{e.addEventListener("input",(()=>{((e,t)=>{e.validity.valid?r(e.form,e,t):((e,t,r,o)=>{const n=e.querySelector(`#${t.id}-error`);n&&(n.textContent=r),t.classList.add(o.inputErrorClass)})(e.form,e,e.validationMessage,t)})(e,t),o(n,a,t)}))}))})(t,e)))})(t)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzL3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvQXBpLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIl9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7IiwiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcclxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdC1idG5cIixcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnRuX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JcIixcclxufTtcclxuXHJcbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSwgc2V0dGluZ3MpID0+IHtcclxuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XHJcbiAgaWYgKGVycm9yRWxlbWVudCkgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XHJcbn07XHJcblxyXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncykgPT4ge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICBpZiAoZXJyb3JFbGVtZW50KSBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XHJcbn07XHJcblxyXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoaW5wdXRFbGVtZW50LCBzZXR0aW5ncykgPT4ge1xyXG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICBzaG93SW5wdXRFcnJvcihcclxuICAgICAgaW5wdXRFbGVtZW50LmZvcm0sXHJcbiAgICAgIGlucHV0RWxlbWVudCxcclxuICAgICAgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLFxyXG4gICAgICBzZXR0aW5nc1xyXG4gICAgKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50LmZvcm0sIGlucHV0RWxlbWVudCwgc2V0dGluZ3MpO1xyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+XHJcbiAgaW5wdXRMaXN0LnNvbWUoKGlucHV0KSA9PiAhaW5wdXQudmFsaWRpdHkudmFsaWQpO1xyXG5cclxuY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbGVtZW50LCBzZXR0aW5ncykgPT4ge1xyXG4gIGlmICghYnV0dG9uRWxlbWVudCkgcmV0dXJuO1xyXG4gIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxufTtcclxuXHJcbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpID0+IHtcclxuICBpZiAoIWJ1dHRvbkVsZW1lbnQpIHJldHVybjtcclxuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcclxuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbGVtZW50LCBzZXR0aW5ncykgPT4ge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHNldHRpbmdzLmlucHV0U2VsZWN0b3IpXHJcbiAgKTtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgIHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgKTtcclxuXHJcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT5cclxuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHNldHRpbmdzKVxyXG4gICk7XHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBzZXR0aW5ncyk7XHJcbn07XHJcblxyXG5jb25zdCBzZXRFdmVudExpc3RlbmVyID0gKGZvcm1FbGVtZW50LCBzZXR0aW5ncykgPT4ge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHNldHRpbmdzLmlucHV0U2VsZWN0b3IpXHJcbiAgKTtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgIHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgKTtcclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBzZXR0aW5ncyk7XHJcblxyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50LCBzZXR0aW5ncyk7XHJcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChzZXR0aW5ncykgPT4ge1xyXG4gIGNvbnN0IGZvcm1MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5mb3JtU2VsZWN0b3IpO1xyXG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiBzZXRFdmVudExpc3RlbmVyKGZvcm1FbGVtZW50LCBzZXR0aW5ncykpO1xyXG59O1xyXG5cclxuZXhwb3J0IHsgcmVzZXRWYWxpZGF0aW9uIH07XHJcbiIsImNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcclxuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICBnZXRBcHBJbmZvKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcclxuICB9XHJcblxyXG4gIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4oKHJlcykgPT5cclxuICAgICAgcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKChyZXMpID0+XHJcbiAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgYWJvdXQgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+XHJcbiAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZUF2YXRhcih7IGF2YXRhciB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhdmF0YXIgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+XHJcbiAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBsaW5rIH0pLFxyXG4gICAgfSkudGhlbigocmVzKSA9PlxyXG4gICAgICByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICByZW1vdmVDYXJkKGlkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4oKHJlcykgPT5cclxuICAgICAgcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKChyZXMpID0+XHJcbiAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHVubGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKChyZXMpID0+XHJcbiAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEFwaTtcclxuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuaW1wb3J0IHtcclxuICBlbmFibGVWYWxpZGF0aW9uLFxyXG4gIHNldHRpbmdzLFxyXG4gIHJlc2V0VmFsaWRhdGlvbixcclxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xyXG5cclxuaW1wb3J0IGF2YXRhckltZyBmcm9tIFwiLi4vaW1hZ2VzL2F2YXRhci5qcGdcIjtcclxuaW1wb3J0IGxvZ29JbWcgZnJvbSBcIi4uL2ltYWdlcy9Mb2dvXygxKS5zdmdcIjtcclxuaW1wb3J0IHBlbmNpbEljb24gZnJvbSBcIi4uL2ltYWdlcy9Hcm91cF8yLnN2Z1wiO1xyXG5pbXBvcnQgcGx1c0ljb24gZnJvbSBcIi4uL2ltYWdlcy9Hcm91cF8yNi5zdmdcIjtcclxuaW1wb3J0IGNsb3NlSWNvbiBmcm9tIFwiLi4vaW1hZ2VzL0dyb3VwXzI3LnN2Z1wiO1xyXG5pbXBvcnQgYXZhdGFyUGVuY2lsSWNvbiBmcm9tIFwiLi4vaW1hZ2VzL2F2YXRhcl9wZW5jaWwuc3ZnXCI7XHJcblxyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XHJcbiAgLy8gSW5qZWN0IGltYWdlc1xyXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaGVhZGVyX19sb2dvXCIpLnNyYyA9IGxvZ29JbWc7XHJcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19wZW5jaWwtaWNvblwiKS5zcmMgPSBhdmF0YXJQZW5jaWxJY29uO1xyXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idG4gaW1nXCIpLnNyYyA9IHBlbmNpbEljb247XHJcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnRuIGltZ1wiKS5zcmMgPSBwbHVzSWNvbjtcclxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19jbG9zZS1idG4gaW1nXCIpLmZvckVhY2goKGltZykgPT4ge1xyXG4gICAgaW1nLnNyYyA9IGNsb3NlSWNvbjtcclxuICB9KTtcclxuXHJcbiAgLy8gQVBJXHJcbiAgY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIGF1dGhvcml6YXRpb246IFwiYjExZTQ2OGItM2Y1OS00ZWZiLTk4NWUtZjg1NDViNzljZjA3XCIsXHJcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgfSxcclxuICB9KTtcclxuXHJcbiAgLy8gRWxlbWVudHNcclxuICBjb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idG5cIik7XHJcbiAgY29uc3QgY2FyZE1vZGFsQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnRuXCIpO1xyXG4gIGNvbnN0IGF2YXRhck1vZGFsQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnRuXCIpO1xyXG5cclxuICBjb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcclxuICBjb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xyXG4gIGNvbnN0IGF2YXRhckltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XHJcblxyXG4gIGNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcclxuICBjb25zdCBhdmF0YXJFZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1tb2RhbFwiKTtcclxuICBjb25zdCBjYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLW1vZGFsXCIpO1xyXG4gIGNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcclxuXHJcbiAgY29uc3QgZWRpdEZvcm1FbGVtZW50ID0gZG9jdW1lbnQuZm9ybXNbXCJlZGl0LXByb2ZpbGVcIl07XHJcbiAgY29uc3QgZWRpdE1vZGFsTmFtZUlucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgXCIjcHJvZmlsZS1uYW1lLWlucHV0XCJcclxuICApO1xyXG4gIGNvbnN0IGVkaXRNb2RhbERlc2NyaXB0aW9uID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiXHJcbiAgKTtcclxuICBjb25zdCBlZGl0U3VibWl0QnV0dG9uID0gZWRpdEZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XHJcblxyXG4gIGNvbnN0IGNhcmRGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJjYXJkX19mb3JtXCJdO1xyXG4gIGNvbnN0IGNhcmRTdWJtaXRCdXR0b24gPSBjYXJkRm9ybS5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xyXG4gIGNvbnN0IGNhcmROYW1lSW5wdXQgPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1uYW1lLWlucHV0XCIpO1xyXG4gIGNvbnN0IGNhcmRMaW5rSW5wdXQgPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1saW5rLWlucHV0XCIpO1xyXG5cclxuICBjb25zdCBhdmF0YXJGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJlZGl0LWF2YXRhclwiXTtcclxuICBjb25zdCBhdmF0YXJJbnB1dCA9IGF2YXRhckZvcm0ucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWF2YXRhci1pbnB1dFwiKTtcclxuICBjb25zdCBhdmF0YXJTdWJtaXRCdXR0b24gPSBhdmF0YXJGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XHJcblxyXG4gIGNvbnN0IHByZXZpZXdNb2RhbEltYWdlRWwgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XHJcbiAgY29uc3QgcHJldmlld01vZGFsQ2FwdGlvbiA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xyXG5cclxuICBjb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIik7XHJcbiAgY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcclxuXHJcbiAgY29uc3QgZGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1tb2RhbFwiKTtcclxuICBjb25zdCBjb25maXJtRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiY29uZmlybS1kZWxldGVcIl07XHJcbiAgY29uc3QgZGVsZXRlQ29uZmlybUJ1dHRvbiA9IGNvbmZpcm1Gb3JtLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICBcImJ1dHRvblt0eXBlPSdzdWJtaXQnXVwiXHJcbiAgKTtcclxuXHJcbiAgbGV0IHNlbGVjdGVkQ2FyZCA9IG51bGw7XHJcbiAgbGV0IHNlbGVjdGVkQ2FyZElkID0gbnVsbDtcclxuXHJcbiAgZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XHJcbiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjS2V5KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcclxuICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NLZXkpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gaGFuZGxlRXNjS2V5KGV2ZW50KSB7XHJcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIGNvbnN0IG9wZW5Nb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgICBpZiAob3Blbk1vZGFsKSBjbG9zZU1vZGFsKG9wZW5Nb2RhbCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XHJcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jb250ZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcclxuICAgICAgLmNsb25lTm9kZSh0cnVlKTtcclxuICAgIGNvbnN0IGNhcmROYW1lRWxlbWVudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XHJcbiAgICBjb25zdCBjYXJkSW1hZ2VFbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcclxuICAgIGNvbnN0IGNhcmRMaWtlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcclxuICAgIGNvbnN0IGNhcmREZWxldGVCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIik7XHJcblxyXG4gICAgY2FyZE5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xyXG4gICAgY2FyZEltYWdlRWxlbWVudC5zcmMgPSBkYXRhLmxpbms7XHJcbiAgICBjYXJkSW1hZ2VFbGVtZW50LmFsdCA9IGRhdGEubmFtZTtcclxuICAgIGlmIChkYXRhLmlzTGlrZWQpIHtcclxuICAgICAgY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uLWxpa2VkXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhcmRMaWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGlzTGlrZWQgPSBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoXHJcbiAgICAgICAgXCJjYXJkX19saWtlLWJ1dHRvbi1saWtlZFwiXHJcbiAgICAgICk7XHJcbiAgICAgIGNvbnN0IHRvZ2dsZUxpa2UgPSBpc0xpa2VkXHJcbiAgICAgICAgPyBhcGkudW5saWtlQ2FyZChkYXRhLl9pZClcclxuICAgICAgICA6IGFwaS5saWtlQ2FyZChkYXRhLl9pZCk7XHJcblxyXG4gICAgICB0b2dnbGVMaWtlXHJcbiAgICAgICAgLnRoZW4oKHVwZGF0ZWRDYXJkKSA9PiB7XHJcbiAgICAgICAgICBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFxyXG4gICAgICAgICAgICBcImNhcmRfX2xpa2UtYnV0dG9uLWxpa2VkXCIsXHJcbiAgICAgICAgICAgIHVwZGF0ZWRDYXJkLmlzTGlrZWRcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBMaWtlL1VubGlrZSBmYWlsZWQ6XCIsIGVycik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjYXJkSW1hZ2VFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xyXG4gICAgICBwcmV2aWV3TW9kYWxJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcclxuICAgICAgcHJldmlld01vZGFsSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XHJcbiAgICAgIHByZXZpZXdNb2RhbENhcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjYXJkRGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xyXG4gICAgICBzZWxlY3RlZENhcmRJZCA9IGRhdGEuX2lkO1xyXG4gICAgICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmVuZGVyQ2FyZChpdGVtLCBtZXRob2QgPSBcInByZXBlbmRcIikge1xyXG4gICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChpdGVtKTtcclxuICAgIGNhcmRzTGlzdFttZXRob2RdKGNhcmRFbGVtZW50KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGhhbmRsZUFkZENhcmRTdWJtaXQoZXZ0KSB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBjb25zdCBuYW1lID0gY2FyZE5hbWVJbnB1dC52YWx1ZS50cmltKCk7XHJcbiAgICBjb25zdCBsaW5rID0gY2FyZExpbmtJbnB1dC52YWx1ZS50cmltKCk7XHJcblxyXG4gICAgaWYgKCFuYW1lIHx8ICFsaW5rKSB7XHJcbiAgICAgIGFsZXJ0KFwiUGxlYXNlIGVudGVyIGJvdGggYSBuYW1lIGFuZCBhIHZhbGlkIGltYWdlIFVSTC5cIik7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjYXJkU3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIGNhcmRTdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xyXG5cclxuICAgIGFwaVxyXG4gICAgICAuYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSlcclxuICAgICAgLnRoZW4oKGNhcmREYXRhKSA9PiB7XHJcbiAgICAgICAgcmVuZGVyQ2FyZChjYXJkRGF0YSwgXCJwcmVwZW5kXCIpO1xyXG4gICAgICAgIGNhcmRGb3JtLnJlc2V0KCk7XHJcbiAgICAgICAgY2xvc2VNb2RhbChjYXJkTW9kYWwpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihcIuKdjCBFcnJvciBhZGRpbmcgY2FyZDpcIiwgZXJyKSlcclxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgIGNhcmRTdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICBjYXJkU3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gaGFuZGxlRWRpdEZvcm1TdWJtaXQoZXZ0KSB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnN0IG5ld05hbWUgPSBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWU7XHJcbiAgICBjb25zdCBuZXdBYm91dCA9IGVkaXRNb2RhbERlc2NyaXB0aW9uLnZhbHVlO1xyXG5cclxuICAgIGVkaXRTdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xyXG5cclxuICAgIGFwaVxyXG4gICAgICAuZWRpdFVzZXJJbmZvKHsgbmFtZTogbmV3TmFtZSwgYWJvdXQ6IG5ld0Fib3V0IH0pXHJcbiAgICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgICAgICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gZGF0YS5hYm91dDtcclxuICAgICAgICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihcIuKdjCBFcnJvciB1cGRhdGluZyB1c2VyOlwiLCBlcnIpKVxyXG4gICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgZWRpdFN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQoZXZ0KSB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnN0IG5ld0F2YXRhckxpbmsgPSBhdmF0YXJJbnB1dC52YWx1ZS50cmltKCk7XHJcblxyXG4gICAgaWYgKCFuZXdBdmF0YXJMaW5rKSB7XHJcbiAgICAgIGFsZXJ0KFwiUGxlYXNlIGVudGVyIGEgdmFsaWQgaW1hZ2UgVVJMLlwiKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGF2YXRhclN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XHJcblxyXG4gICAgYXBpXHJcbiAgICAgIC51cGRhdGVBdmF0YXIoeyBhdmF0YXI6IG5ld0F2YXRhckxpbmsgfSlcclxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICBhdmF0YXJJbWFnZS5zcmMgPSBkYXRhLmF2YXRhcjtcclxuICAgICAgICBjbG9zZU1vZGFsKGF2YXRhckVkaXRNb2RhbCk7XHJcbiAgICAgICAgYXZhdGFyRm9ybS5yZXNldCgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRXJyb3IgdXBkYXRpbmcgYXZhdGFyOlwiLCBlcnIpO1xyXG4gICAgICB9KVxyXG4gICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgYXZhdGFyU3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uZmlybUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBpZiAoIXNlbGVjdGVkQ2FyZElkKSByZXR1cm47XHJcblxyXG4gICAgZGVsZXRlQ29uZmlybUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiRGVsZXRpbmcuLi5cIjtcclxuXHJcbiAgICBhcGlcclxuICAgICAgLnJlbW92ZUNhcmQoc2VsZWN0ZWRDYXJkSWQpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XHJcbiAgICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBEZWxldGUgZmFpbGVkOlwiLCBlcnIpO1xyXG4gICAgICB9KVxyXG4gICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgZGVsZXRlQ29uZmlybUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiWWVzLCBEZWxldGVcIjtcclxuICAgICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKS5mb3JFYWNoKChidXR0b24pID0+IHtcclxuICAgIGNvbnN0IG1vZGFsID0gYnV0dG9uLmNsb3Nlc3QoXCIubW9kYWxcIik7XHJcbiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwobW9kYWwpKTtcclxuICB9KTtcclxuXHJcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbFwiKS5mb3JFYWNoKChtb2RhbCkgPT4ge1xyXG4gICAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSBtb2RhbCkgY2xvc2VNb2RhbChtb2RhbCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgcHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIGVkaXRNb2RhbE5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lLnRleHRDb250ZW50O1xyXG4gICAgZWRpdE1vZGFsRGVzY3JpcHRpb24udmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XHJcbiAgICByZXNldFZhbGlkYXRpb24oZWRpdEZvcm1FbGVtZW50LCBzZXR0aW5ncyk7XHJcbiAgICBvcGVuTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XHJcbiAgfSk7XHJcblxyXG4gIGNhcmRNb2RhbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gb3Blbk1vZGFsKGNhcmRNb2RhbCkpO1xyXG4gIGF2YXRhck1vZGFsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBvcGVuTW9kYWwoYXZhdGFyRWRpdE1vZGFsKSk7XHJcblxyXG4gIGVkaXRGb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRGb3JtU3VibWl0KTtcclxuICBjYXJkRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUFkZENhcmRTdWJtaXQpO1xyXG4gIGF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJGb3JtU3VibWl0KTtcclxuXHJcbiAgYXBpXHJcbiAgICAuZ2V0QXBwSW5mbygpXHJcbiAgICAudGhlbigoW2NhcmRzLCB1c2VyXSkgPT4ge1xyXG4gICAgICBjYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XHJcbiAgICAgICAgcmVuZGVyQ2FyZChjYXJkLCBcImFwcGVuZFwiKTtcclxuICAgICAgfSk7XHJcbiAgICAgIGF2YXRhckltYWdlLnNyYyA9IHVzZXIuYXZhdGFyO1xyXG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXIubmFtZTtcclxuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gdXNlci5hYm91dDtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgY2FyZHMgb3IgdXNlciBpbmZvIGZyb20gQVBJOlwiLCBlcnIpO1xyXG4gICAgfSk7XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xyXG59KTtcclxuIl0sIm5hbWVzIjpbIl9fd2VicGFja19yZXF1aXJlX18iLCJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImVycm9yRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50Iiwic29tZSIsImlucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsImFkZCIsImNvbnN0cnVjdG9yIiwiX3JlZiIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJnZXRBcHBJbmZvIiwiUHJvbWlzZSIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwicmVqZWN0Iiwic3RhdHVzIiwiZWRpdFVzZXJJbmZvIiwiX3JlZjIiLCJuYW1lIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInVwZGF0ZUF2YXRhciIsIl9yZWYzIiwiYXZhdGFyIiwiYWRkQ2FyZCIsIl9yZWY0IiwibGluayIsInJlbW92ZUNhcmQiLCJsaWtlQ2FyZCIsImNhcmRJZCIsInVubGlrZUNhcmQiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJzcmMiLCJsb2dvSW1nIiwiYXZhdGFyUGVuY2lsSWNvbiIsInBlbmNpbEljb24iLCJwbHVzSWNvbiIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiaW1nIiwiY2xvc2VJY29uIiwiYXBpIiwiQXBpIiwiYXV0aG9yaXphdGlvbiIsInByb2ZpbGVFZGl0QnV0dG9uIiwiY2FyZE1vZGFsQnV0dG9uIiwiYXZhdGFyTW9kYWxCdXR0b24iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsImF2YXRhckltYWdlIiwiZWRpdFByb2ZpbGVNb2RhbCIsImF2YXRhckVkaXRNb2RhbCIsImNhcmRNb2RhbCIsInByZXZpZXdNb2RhbCIsImVkaXRGb3JtRWxlbWVudCIsImZvcm1zIiwiZWRpdE1vZGFsTmFtZUlucHV0IiwiZWRpdE1vZGFsRGVzY3JpcHRpb24iLCJlZGl0U3VibWl0QnV0dG9uIiwiY2FyZEZvcm0iLCJjYXJkU3VibWl0QnV0dG9uIiwiY2FyZE5hbWVJbnB1dCIsImNhcmRMaW5rSW5wdXQiLCJhdmF0YXJGb3JtIiwiYXZhdGFySW5wdXQiLCJhdmF0YXJTdWJtaXRCdXR0b24iLCJwcmV2aWV3TW9kYWxJbWFnZUVsIiwicHJldmlld01vZGFsQ2FwdGlvbiIsImNhcmRUZW1wbGF0ZSIsImNhcmRzTGlzdCIsImRlbGV0ZU1vZGFsIiwiY29uZmlybUZvcm0iLCJkZWxldGVDb25maXJtQnV0dG9uIiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJvcGVuTW9kYWwiLCJtb2RhbCIsImhhbmRsZUVzY0tleSIsImNsb3NlTW9kYWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJrZXkiLCJyZW5kZXJDYXJkIiwiaXRlbSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImNhcmRFbGVtZW50IiwiZGF0YSIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJjYXJkTmFtZUVsZW1lbnQiLCJjYXJkSW1hZ2VFbGVtZW50IiwiY2FyZExpa2VCdXR0b24iLCJjYXJkRGVsZXRlQnV0dG9uIiwiYWx0IiwiaXNMaWtlZCIsImNvbnRhaW5zIiwiX2lkIiwidXBkYXRlZENhcmQiLCJ0b2dnbGUiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImdldENhcmRFbGVtZW50IiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJmaW5hbGx5IiwiYnV0dG9uIiwiY2xvc2VzdCIsInRhcmdldCIsInZhbHVlIiwicmVzZXRWYWxpZGF0aW9uIiwiQXJyYXkiLCJmcm9tIiwibmV3TmFtZSIsIm5ld0Fib3V0IiwidHJpbSIsImNhcmREYXRhIiwicmVzZXQiLCJhbGVydCIsIm5ld0F2YXRhckxpbmsiLCJjYXJkcyIsInVzZXIiLCJjYXJkIiwic2V0RXZlbnRMaXN0ZW5lciIsImNoZWNrSW5wdXRWYWxpZGl0eSIsImZvcm0iLCJzaG93SW5wdXRFcnJvciIsImVycm9yTWVzc2FnZSIsInZhbGlkYXRpb25NZXNzYWdlIiwiZW5hYmxlVmFsaWRhdGlvbiJdLCJzb3VyY2VSb290IjoiIn0=